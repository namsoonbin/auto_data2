# 쿠팡 데이터 통합 분석 결과

## 1. 파일별 데이터 구조

### 📊 광고비 데이터 (61행)
**파일**: `2520251024_A01116666_custom_report (1).xlsx`

**핵심 컬럼**:
- `광고 집행 옵션 ID`: **매칭 키** (판매 데이터와 조인)
- `광고비(원)`: 광고 지출 금액
- `노출수`: 광고 노출 횟수
- `클릭수`: 광고 클릭 횟수
- `총 판매 수량 (1일)`: 광고로 인한 판매량

**특징**: 옵션 ID별로 광고 성과 데이터 제공

---

### 📈 판매량 데이터 (48행)
**파일**: `SELLER_INSIGHTS_VENDOR_ITEM_METRICS_(0) (56).xlsx`

**핵심 컬럼**:
- `옵션 ID`: **매칭 키** (광고 데이터와 조인)
- `옵션명`: 상세한 상품 옵션 정보
- `상품명`: **매칭 키** (마진 데이터와 조인)
- `매출(원)`: 일별 매출
- `판매량`: 판매 수량
- `주문`: 주문 건수
- `총 매출(원)`: 누적 매출
- `총 판매수`: 누적 판매량

**특징**: 옵션별로 상세한 판매 성과 제공

---

### 💰 마진 데이터 (18행)
**파일**: `마진데이터.xlsx`

**핵심 컬럼**:
- `상품명`: **매칭 키** (판매 데이터와 조인, 단순 상품명)
- `한국원가`: 원가
- `판매가 택배비 포함`: 판매가
- `판매마진`: 상품별 마진 금액
- `제품순이익%`: 마진율
- `총 수수료(%)`: 총 수수료율
- `총 수수료(원)`: 총 수수료 금액

**특징**: 상품별 원가/마진 정보, 배송비/수수료 포함

---

## 2. 데이터 매칭 전략

### ✅ 1단계: 판매 + 광고 데이터 조인
```
판매량 데이터 (옵션 ID)  ←→  광고비 데이터 (광고 집행 옵션 ID)
```
- **매칭 방식**: `옵션 ID` 완전 일치 (Inner Join)
- **결과**: 광고 성과가 포함된 판매 데이터

### ⚠️ 2단계: 판매 + 마진 데이터 조인 (도전 과제)
```
판매량 데이터 (상품명: "헤누스 셰이버 남자 전기 면도기 생활방수 전동 면도기")
         ↓
마진 데이터 (상품명: "쉐이버")
```

**문제점**: 
- 판매 데이터의 상품명이 매우 상세함
- 마진 데이터의 상품명은 간략함
- 완전 일치 불가능

**해결책 옵션**:

**A. 부분 문자열 매칭** ⭐ 추천
```python
# 마진 데이터의 상품명이 판매 데이터 상품명에 포함되는지 확인
if '쉐이버' in '헤누스 셰이버 남자 전기 면도기 생활방수 전동 면도기':
    match = True
```

**B. 키워드 매핑 테이블 생성**
```python
mapping = {
    '쉐이버': ['헤누스 셰이버', '면도기'],
    '일자면도기': ['일자 면도기'],
    # ...
}
```

**C. 수동 매핑 파일 생성**
```csv
판매_상품명,마진_상품명
헤누스 셰이버 남자 전기 면도기 생활방수 전동 면도기,쉐이버
...
```

---

## 3. 최종 통합 데이터 구조

### 🎯 통합 후 데이터 컬럼
```
[판매 데이터]
- 옵션 ID
- 옵션명
- 상품명
- 매출(원)
- 판매량
- 주문

[광고 데이터]
- 광고비(원)
- 노출수
- 클릭수

[마진 데이터]
- 한국원가
- 판매가
- 판매마진
- 제품순이익%
- 총 수수료(%)

[계산 필드]
- 순이익 = 매출 - 원가 - 광고비 - 수수료
- 실제 마진율 = (순이익 / 매출) × 100
- ROAS = 매출 / 광고비
- 광고비 비율 = (광고비 / 매출) × 100
```

---

## 4. 작업 흐름

### Step 1: 데이터 업로드
```
사용자 → 3개 파일 업로드 → 백엔드 파싱
```

### Step 2: 데이터 매칭 & 통합
```python
# 1. 판매 + 광고 조인 (옵션 ID)
merged_1 = pd.merge(
    sales_df, 
    ads_df, 
    left_on='옵션 ID',
    right_on='광고 집행 옵션 ID',
    how='left'  # 광고 없는 판매도 포함
)

# 2. 판매 + 마진 조인 (상품명 부분 매칭)
merged_2 = fuzzy_match_by_product_name(
    merged_1,
    margin_df
)
```

### Step 3: 실적 계산
```python
# 각 옵션별 수익 계산
for row in merged_data:
    revenue = row['매출(원)']
    cost = row['한국원가'] * row['판매량']
    ad_cost = row['광고비(원)']
    fees = row['총 수수료(원)']
    
    profit = revenue - cost - ad_cost - fees
    margin_rate = (profit / revenue) * 100
```

### Step 4: 대시보드 표시
```
- 옵션별 수익 현황
- 광고 효율 분석 (ROAS, CPC)
- 상품별 마진율 비교
- 일별 트렌드
```

---

## 5. 구현 우선순위

### Phase 1: 기본 통합 (필수) ✅
- [x] 판매 + 광고 데이터 조인 (옵션 ID)
- [ ] 기본 수익 계산 (광고비 제외한 마진)
- [ ] 대시보드 기본 차트

### Phase 2: 마진 데이터 통합 (중요) 🔥
- [ ] 상품명 부분 매칭 알고리즘 구현
- [ ] 수동 매핑 UI 제공 (매칭 안된 상품 처리)
- [ ] 정확한 원가/마진 계산

### Phase 3: 고급 분석 (선택) 📊
- [ ] 광고 ROI 분석
- [ ] 상품별 수익성 랭킹
- [ ] 주간/월간 트렌드 분석
- [ ] PDF 리포트 생성

---

## 6. 즉시 구현 가능한 솔루션

### 🚀 빠른 시작 방법

**1. 마진 데이터에 매핑 컬럼 추가**
```excel
마진데이터.xlsx에 새 컬럼 추가:
- "옵션명 키워드": 판매 데이터의 옵션명과 매칭할 키워드 입력
```

**2. 백엔드에 매칭 로직 추가**
```python
def match_product_name(sales_name, margin_keywords):
    # 키워드가 판매명에 포함되는지 확인
    for keyword in margin_keywords:
        if keyword.lower() in sales_name.lower():
            return True
    return False
```

**3. 3단계 업로드 프로세스**
```
① 광고비 업로드
② 판매량 업로드  
③ 마진 데이터 업로드
→ 자동 통합 & 계산 & 대시보드 표시
```

---

## 7. 예상 결과

### 통합 데이터 예시
```
옵션 ID: 89048355196
옵션명: 헤누스 셰이버 남자 전기 면도기 생활방수 전동 면도기, 1개, 1개
매출: 5,040,000원
판매량: 180개
광고비: 12,500원 (예시)
원가: 1,592,180원 (8,851원 × 180)
수수료: 504,000원 (10%)
순이익: 2,931,320원
실제 마진율: 58.2%
ROAS: 403.2 (매출/광고비)
```

