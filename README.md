# 판매 데이터 자동화 시스템 - 옵션별 설정 버전

## 📋 프로젝트 개요

이 프로젝트는 e-커머스 판매 데이터를 자동으로 처리하고 분석하는 PySide6 기반 데스크톱 애플리케이션입니다. 최신 버전에서는 **옵션별 리워드 및 가구매 설정 시스템**이 추가되어 더욱 세밀한 상품 관리가 가능합니다.

## 🎯 주요 기능

### 📊 **데이터 처리 및 분석**
- 주문조회 파일 기반 옵션별 매출 분석
- 환불수량 정확한 처리 (클레임상태 기반)
- 마진정보 파일과의 안전한 병합
- 실시간 통계 대시보드

### 💰 **옵션별 리워드 관리**
- 날짜별, 상품별, **옵션별** 리워드 설정
- 직관적인 GUI 인터페이스
- 일괄 적용 및 빠른 설정 버튼
- 검색 및 필터링 기능
- 설정 복사 기능 (날짜간)

### 🛒 **옵션별 가구매 관리**
- 날짜별, 상품별, **옵션별** 가구매 개수 설정
- 리워드와 동일한 사용자 경험
- 효율적인 대량 설정 도구
- 자동 계산 및 적용

### 📈 **고급 분석 기능**
- 순이익 = 판매마진 - 가구매 비용 - 리워드
- 광고비율 = (리워드 + 가구매 비용) / 순매출
- 환불수량 자동 차감
- 벡터화된 고성능 계산

## 🆕 최신 업데이트 (2025-09-11)

### **옵션별 설정 시스템 구현**

#### 🎯 **핵심 개선사항**
1. **GUI 인터페이스 확장**
   - 리워드 관리: 5컬럼 테이블 (선택, 상품ID, 상품명, **옵션정보**, 리워드 금액)
   - 가구매 관리: 5컬럼 테이블 (선택, 상품ID, 상품명, **옵션정보**, 가구매 개수)
   - 모든 컬럼 인덱스 참조 업데이트 완료

2. **백엔드 시스템 업그레이드**
   - `get_reward_for_date_and_product(product_id, date_str, option_info='')` 함수 확장
   - `get_purchase_count_for_date_and_product(product_id, date_str, option_info='')` 함수 확장
   - 3-tuple 키 시스템: `(date, product_id, option_info)` 구조

3. **자동 마이그레이션 시스템**
   - `_migrate_legacy_rewards()`: 기존 리워드 설정을 옵션별로 자동 변환
   - `_migrate_legacy_purchases()`: 기존 가구매 설정을 옵션별로 자동 변환
   - 완벽한 하위 호환성 보장

4. **데이터 처리 최적화**
   - 벡터화된 리워드 적용: `get_reward_vectorized(row)`
   - 벡터화된 가구매 적용: `get_purchase_vectorized(row)`
   - 옵션정보 전달: `row.get('옵션정보', '')`

#### 🔧 **기술적 구현 세부사항**

**JSON 데이터 구조 확장:**
```json
{
  "rewards": [
    {
      "start_date": "2025-09-11",
      "end_date": "2025-09-11", 
      "product_id": "12345",
      "option_info": "색상: 빨강, 사이즈: M",
      "reward": 3000
    }
  ]
}
```

**GUI 컬럼 매핑:**
- 인덱스 0: 선택 체크박스
- 인덱스 1: 상품ID
- 인덱스 2: 상품명
- 인덱스 3: **옵션정보** (신규 추가)
- 인덱스 4: 리워드 금액 / 가구매 개수

**백엔드 함수 호출:**
```python
# 리포트 생성 시 옵션정보 전달
def get_reward_vectorized(row):
    return get_reward_for_date_and_product(
        row['상품ID'], 
        date, 
        row.get('옵션정보', '')
    )
```

#### ✅ **검증 완료 사항**
- [x] GUI 테이블 구조 5컬럼 확장
- [x] 모든 컬럼 인덱스 참조 업데이트
- [x] 백엔드 함수 시그니처 확장
- [x] 마이그레이션 시스템 구현
- [x] 벡터화된 처리에서 옵션정보 전달
- [x] JSON 저장/로드 옵션정보 지원
- [x] 하위 호환성 보장

## 📁 파일 구조

```
data_automation/
├── desktop_app.py              # 메인 GUI 애플리케이션
├── modules/                    # 모듈 디렉토리
│   ├── config.py              # 설정 관리
│   ├── file_handler.py        # 파일 처리
│   └── report_generator.py    # 리포트 생성 (옵션별 로직 포함)
├── dist/                      # 배포용 실행 파일
│   └── 판매데이터자동화_옵션별설정시스템.exe  # 최신 버전
├── 리워드설정.json            # 옵션별 리워드 설정
├── 가구매설정.json            # 옵션별 가구매 설정
└── 마진정보.xlsx              # 상품 마진 정보
```

## 🚀 사용법

### **1. 프로그램 실행**
```bash
# 소스코드 실행
python desktop_app.py

# 또는 배포 버전 실행
dist/판매데이터자동화_옵션별설정시스템.exe
```

### **2. 옵션별 리워드 설정**
1. 메인 화면에서 "💰 리워드 관리" 버튼 클릭
2. 날짜 선택 및 상품 검색
3. 옵션별로 개별 리워드 금액 설정
4. 일괄 적용 또는 빠른 설정 버튼 사용
5. 저장 버튼으로 설정 완료

### **3. 옵션별 가구매 설정**
1. 메인 화면에서 "🛒 가구매 관리" 버튼 클릭
2. 날짜 선택 및 상품 검색
3. 옵션별로 개별 가구매 개수 설정
4. 일괄 적용 또는 빠른 설정 버튼 사용
5. 저장 버튼으로 설정 완료

### **4. 자동 처리 실행**
1. 다운로드 폴더 선택
2. 주문조회 파일 암호 입력 (기본: 1234)
3. "자동화 시작" 또는 "작업폴더 처리" 버튼 클릭
4. 실시간 진행 상황 모니터링

## 📊 생성되는 리포트

### **컬럼 구성**
- **기본 정보**: 상품ID, 상품명, 옵션정보, 수량, 환불수량
- **매출 정보**: 결제금액, 환불금액, 매출, 순매출
- **마진 정보**: 판매가, 마진율, 판매마진
- **가구매 정보**: 가구매 개수, 개당 가구매 비용, 가구매 비용
- **리워드 정보**: 리워드 금액 (옵션별 적용)
- **최종 분석**: 순이익, 광고비율, 이윤율

### **계산 공식**
```
순이익 = 판매마진 - 가구매 비용 - 리워드
광고비율 = (리워드 + 가구매 비용) / 순매출 × 100
이윤율 = 순이익 / 순매출 × 100
```

## 🔧 기술 스택

- **Python 3.13.6**
- **PySide6**: Qt 기반 GUI 프레임워크
- **pandas**: 데이터 처리 및 분석
- **numpy**: 수치 계산
- **openpyxl**: Excel 파일 처리
- **msoffcrypto-tool**: 암호화된 Excel 파일 처리
- **PyInstaller**: 실행 파일 생성

## ⚡ 성능 최적화

### **메모리 효율성**
- 스마트 캐싱 시스템 (파일 수정 시간 기반)
- 벡터화된 pandas 연산 (iterrows() 제거)
- 안전한 메모리 정리 (가비지 컬렉션)

### **처리 속도**
- O(1) 딕셔너리 기반 리워드/가구매 조회
- 병렬 처리 가능한 모듈화 설계
- 중복 계산 최소화

## 🛡️ 안정성 보장

### **데이터 무결성**
- 포괄적 예외 처리
- 입력 데이터 검증
- 0으로 나누기 방지
- NaN 및 무한대 값 처리

### **사용자 경험**
- 실시간 오류 추적 및 표시
- 진행 상황 모니터링
- 사용자 친화적 에러 메시지
- 자동 백업 및 복구

## 📈 버전 히스토리

### **v4.0 (2025-09-11) - 옵션별 설정 시스템**
- ✅ 옵션별 리워드 설정 시스템 구현
- ✅ 옵션별 가구매 설정 시스템 구현
- ✅ GUI 인터페이스 5컬럼 확장
- ✅ 자동 마이그레이션 시스템 추가
- ✅ 벡터화된 성능 최적화
- ✅ 완벽한 하위 호환성 보장

### **v3.0 (2025-09-09) - UI/UX 개선**
- ✅ 실시간 통계 카드 가시성 개선
- ✅ 오류 추적 및 표시 시스템 구현
- ✅ 하단 고정 버튼 시스템
- ✅ Material Design 3 적용

### **v2.0 (2025-09-03) - 아키텍처 개편**
- ✅ 주문조회 파일 기반 처리로 전환
- ✅ 환불수량 정확한 처리
- ✅ Pandas 모범 사례 적용
- ✅ 강화된 오류 처리

### **v1.0 (2025-08-29) - 초기 버전**
- ✅ 기본 데이터 처리 기능
- ✅ PyQt5 GUI 인터페이스
- ✅ 암호 보호 Excel 파일 처리

## 🤝 지원 및 문의

프로그램 사용 중 문제가 발생하거나 개선 사항이 있으시면 개발자에게 문의해 주세요.

---

**🎉 판매 데이터 자동화 시스템 - 옵션별 설정으로 더욱 정확하고 세밀한 분석이 가능합니다!**